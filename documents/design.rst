设计方案
====
:Release: *V1.0*
:Date:    *2014-04-05 15:15*

1.仓库管理
------
略

2.部品管理
------
2.1 工艺管理
~~~~~~~~
2.2 工序管理
~~~~~~~~
2.3 材料管理
~~~~~~~~
2.4 BOM结果管理
~~~~~~~~~~~
3.订单管理
------
3.1 订单维护
~~~~~~~~
3.1.1 订单状态
^^^^^^^^^^
订单项在系统中可以出现的状态:

A. 未发货：待检查
B. 未发货：
C. 已发货：等待买家确认
D. 已发货：买家确认不合格
E. 已发货：买家确认完成
#. 已删除：d_time is not null

3.1.2 查询
^^^^^^^^
略

3.1.3 增加
^^^^^^^^
略

3.1.4 修改
^^^^^^^^
略

3.1.5 删除
^^^^^^^^
略

3.2 订单导入
~~~~~~~~
| 将从excel或xml中得到原始文件，导入到tmp_order中，忽略任何错误或异常。
| tmp_order仅用于临时存储本次导入的订单，下次导入操作之前，要清空该表。
| 在tmp_order中，有以下任何一种情况的订单项，定义为异常订单项:

A. 订单项的纳期小于等于当前日期
B. 订单项的数量小于等于0
C. 订单项中有其它必要信息缺失，如项目编号等
D. 订单项中要求的部品，在当前部品列表中不存在

| 对于异常订单，应将订单信息反馈给用户，待用户将此批次导入的订单中有异常的部分全部处理完成后，可以完成此次导入。

3.3 订单分析（BOM展开）
~~~~~~~~~~~~~~~
3.3.1 订单分析过程
^^^^^^^^^^^^
| S1. 用户选择需要分析的订单（从所有状态为“未发货”的订单中选取），加入到待分析列表中（tmp_order_filter）。
| S2. 
| S3. 调用分析过程，分析结果存放在tmp_order_analysis中。
| S4. 
| 根据订单（可以筛选得到的订单项）的需求，依据BOM结构展开子部品的需求量，记录在表中。
| IDEA:
| Filter中不必进行订单分组与合并，完全加入分析过程。
| 分析过程之后，根据订单要求生产的部品和纳期进行排序，有用户手动进行分组。

3.3.2 分析结果条件显示
^^^^^^^^^^^^^^
| 分析结果（分析结果记录表）的属性：略。
| 根据部品编号、纳期、工艺类型、所属订单。依据部品分组，显示分组中最早的纳期。
| 筛选得到可发货订单项。
| 筛选得到需要投料的订单项。

4.生产跟踪
------
4.1 投料
~~~~~~
| 根据订单分析结果，可人工干预投料数量，需显示工艺。
| 投料某个部品后，在投料记录表中加入该部品的编号和投料数量等信息，之后调用投料处理存储过程。该部品所属的订单项状态不做改变，仍可加入分析。
| 投料处理存储过程:
|    清空分析结果记录表
|    在仓库记录表中修改该部品预期入库（future）数量，即生产数量。
|    在投料状态跟踪表新增针对该投料单的记录，状态为已投料。
|    查找部品工艺记录表，筛选该部品所需的所有工艺项，依次插入到投料状态跟踪表，并标记状态为NULL（或其它标记，用于标记该步骤未开始）。
|    最后增加入库标记作为某次投料的最终状态标记。

4.2 投料单状态查看
~~~~~~~~~~~
投料单状态均记录在投料单状态表中。
投料状态分类:

A. 预备状态（生产流程页面显示投料完毕，已投料）
B. 该投料单所含部品的工序状态（多个自动展开）。
   如冲，已完成；压，未开始；……
C. 已经入库的状态

4.3 投料单状态修改
~~~~~~~~~~~
投料单状态修改在投料状态跟踪表中进行。

4.3.1 投料完毕
^^^^^^^^^^
投料完成后改变投料单状态为预备状态（或已投料），具体如4.1中所述。

4.3.2 工艺所含工序步骤改变
^^^^^^^^^^^^^^^^
由生产主管手动添加当前的工序，显示在生产流程页面。每完成一步工序，在该投料单所包含的应有工序中确认一步（由未开始或为完成改变为已完成或已结束）。

4.3.3 投料单入库
^^^^^^^^^^^
| 投料单的所有工序已经得到确认（完成）之后，由仓库管理员根据投料单的投入数量和实际生产数量，进行入库操作。
| 根据从库存记录的预期入库（future）数量减去投入数量，同时从库存记录的实际库存数量（actual）加上实际生产数量。
| 在投料状态跟踪表中修改本次投料的入库状态为已入库。


5.数据库结构
-------
Tables:

:ent_equipemet: 
:ent_feeding: 投料记录表
:ent_feeding_status: 投料状态跟踪表（生产跟踪表）
:ent_item: 
:ent_machine: 
:ent_maerial: 
:ent_menu: 
:ent_order: 
:ent_rel_item_drawing: 
:ent_rel_item_item: 
:ent_rel_machine_item: 
:ent_rel_storage_tiem: 
:ent_rel_technology_item_equipment: 部品工艺记录表
:ent_storage: 
:ent_technology: 
:ent_user: 
:tmp_item_full_rel: 
:tmp_order: 
:tmp_order_analysis: 
:tmp_order_analysis2: 
:tmp_order_filter: 
